{% extends 'profile/base_profile.html' %}
{% comment %}
# This file is part of OpenHatch.
# Copyright (C) 2010 Parker Phinney
# Copyright (C) 2009 Karen Rustad
# Copyright (C) 2009, 2010 OpenHatch, Inc.
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU Affero General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU Affero General Public License for more details.
#
# You should have received a copy of the GNU Affero General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.
{% endcomment %}

{% load base_extras %}

{% block less %}
    {{ block.super }}
    <link rel="stylesheet/less" type="text/css" href="{% version '/static/less/profile/portfolio.less' %}">
{% endblock less %}


{% block title %}
{{ person.get_full_name_or_username }}
{% endblock title %}

{% block body_class %}{{ block.super }} view_mode{% endblock body_class %}

{% block main %}
<div id='portfolio' class='module project-display viewer'>
    <div class='module-head'>
        <h3>Projects</h3>
    </div>
    <div id="portfolio-entries" class='module-body {% if editable and edit_mode %}edit{% endif %}'>
        {% with person.get_published_portfolio_entries as portfolio_entries %} 
            {% if not edit_mode %}
            {% if portfolio_entries %}
                <ul id="portfolio-entries-list">
                    {% for pf_entry in portfolio_entries %}
                        {% include 'profile/portfolio/portfolio_entry_element.html' %}
                    {% endfor %}
                </ul>
                {% if how_many_archived_pf_entries %}
                    <a id='show_more_projects' href='#'>
                        And {{ how_many_archived_pf_entries }} more&hellip;</a>
                    <noscript>
                        Enable JavaScript to see more stuff here.
                    </noscript>
                {% endif %}
            {% else %}
                {% if editable %}
                {# YOUR profile lacks projects. #}
                <ul class='nudgebuttons' style="float: left; padding-bottom: 10px;border-bottom: 2px dashed #ccc; margin-bottom: 10px;">
                    <li>
                    <a href='{% url mysite.profile.views.portfolio_editor %}'>
                        <div class='notification'>
                            <div class='arrow' style=''>&rarr; <!--&#9654;--></div>
                            <strong>
                                Add your projects
                            </strong>
                            <span style='font-size: 1.2em;'>
                                If you've contributed to open source already, say so on our project editor!
                                We want you to share your your bug reports, translations, patches, community management, and code commits.
                            </span>
                        </div>
                    </a>
                    </li>

                    <li>
                    <a href='{% url mysite.profile.views.portfolio_editor %}'>
                        <div class='notification smaller'>
                            <div class='arrow' style=''>&rarr; <!--&#9654;--></div>
                            <span>
                                Looking for something to put here? No problem!
                            </span>
                            <strong>
                                Find a volunteer opportunity
                            </strong>
                        </div>
                    </a>
                    </li>
                </ul>

                {# To find things to do in the open source community, use our volunteer opportunity finder.   #}
                {# <a href='{% url mysite.search.views.fetch_bugs %}'>find a bug to work on</a>. <a href='{% url mysite.search.views.fetch_bugs %}'>find someone near you to work with</a>#}

                {% endif %}
                <small style='color: #777; float: left; width: 100%;'>Nothing listed yet.</small>
            {% endif %}
            {% endif %}
        {% endwith %}

    </div>
    <div class="module-foot">
        {% if editable and not edit_mode %}
        <ul>
            <li>
            <a href='?edit_mode=true'>
                Add/edit projects &raquo;
            </a>
            </li>
        </ul>
        {% else %}
        &nbsp;
        {% endif %}
    </div>
</div> <!-- /#portfolio -->
{% endblock main %}

{% block js %}
    <script type='text/javascript'>
        $(ShowMoreProjects.init);
    </script>
    
    <script src="http://cdnjs.cloudflare.com/ajax/libs/json2/20110223/json2.js"></script>
    <script src="{% version '/static/js/vendor/underscore.js' %}"></script>
    <script src="{% version '/static/js/vendor/backbone.js' %}"></script>
    <script src="{% version '/static/js/vendor/backbone.marionette.js' %}"></script>
    <script src="{% version '/static/js/profile/backbone-profile-page.js' %}"></script>
{% endblock js %}

{% block backbone_templates %}

<script type="text/template" id="portfolio-entries-list-template">
<ul id="portfolio-entries-list" class="edit"></ul>
<button class='nudgebutton save_all_portfolio_entries'>Save all</button>
</script>

<script type="text/template" id="portfolio-entry-template">
<div class='submodule clearfix <% if (!save_status) { %>unsaved<% } %>'>
    <div class='portfolio-entry-status-bar 
            <% if (save_status) { %>
                saved'><span class='portfolio_entry_save_status'>Saved</span>
            <% } else { %>
                unsaved'><span class='portfolio_entry_save_status'>Unsaved</span>
            <% } %>
    <a class='delete-portfolio-entry link_like' title="Delete">Î§</a>
    </div>
    <div class='project-stuff'>
        <div class='name_and_icon_flagger'>
                <div class='project_icon' style="background-image: url(<%= project__icon %>)">
                    <span class='alt-text'><%= project__name %></span>
                </div>
            <span class='project_name'>
                <a href='<%= project__url %>'>
                    <%= project__name %>
                </a>
            </span>
        </div>
        <div class='project_description-wrapper'>
            <label for='project_description_<%= project_id %>'>Describe this project:</label>
            <textarea id='project_description_<%= project_id %>' class='project_description'><%= project_description %></textarea>    
        </div>
        <div class='receive_maintainer_updates'>
                <input type='checkbox' class='receive_maintainer_updates'
                       value='<%= receive_maintainer_updates %>'>
	            Receive maintainer updates
	            <a class='explain_maintainer_updates' href='#'>(explain this)</a>
        </div>        
    </div>

    <div class='personal-stuff'>
        <div class='citations-wrapper'>
            <label>
                Web pages that talk about your involvement: <a class='explain_citations' href='#'>(explain this)</a>
            </label>
                <ul class='citations'>
                <% _.each(citation_list, function(citation){ %>
                    <li><a href="<%= citation.url %>"><%= citation.description %></a></li>
                <% }); %>
                </ul>
                <ul class='citation-forms'>
                </ul>
                <span class='add link_like'>Add a page</span>
        </div>
        <div class='experience_description-wrapper'>
            <label for='experience_description'>
                Describe your involvement:
            </label>
            <textarea id='experience_description' class='experience_description'><%= experience_description %></textarea>           
        </div>
        <div class="clearer"></div>
    </div>

        <button class='button save_portfolio_entry'
            <% if (!save_status) { %>
                >Save
            <% } else { %>
            disabled=disabled>Saved
            <% } %>
            </button>
</div>
    
</script>

{% endblock backbone_templates %}
